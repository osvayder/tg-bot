# üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ Telegram –¥–ª—è E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ä–µ—à–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞)

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¢–û–õ–¨–ö–û —Ç–µ—Å—Ç–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç** - –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π
2. **session_string –¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø** - —Ö—Ä–∞–Ω–∏—Ç–µ –≤ .env.test (–≤ .gitignore)
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ session** - –∫–∞–∂–¥—ã–µ 2-3 –º–µ—Å—è—Ü–∞
4. **E2E —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å —Ñ–ª–∞–≥–æ–º** - ENABLE_E2E_TELEGRAM=1

## üìã –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç A: –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä ($0.20)
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://sms-activate.org –∏–ª–∏ –∞–Ω–∞–ª–æ–≥
2. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ $1
3. –ö—É–ø–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–ª—è Telegram (–æ–±—ã—á–Ω–æ $0.20)
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –≤ Telegram

### –í–∞—Ä–∏–∞–Ω—Ç B: –í—Ç–æ—Ä–æ–π –Ω–æ–º–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–ø–∞—Å–Ω—É—é SIM-–∫–∞—Ä—Ç—É
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç Telegram

## üìã –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ API credentials

1. –í–æ–π–¥–∏—Ç–µ –Ω–∞ https://my.telegram.org —Å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "API development tools"
3. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   - **App title**: TG Bot Tests
   - **Short name**: tgbot_tests
   - **Platform**: Other
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ:
   - **api_id**: (—á–∏—Å–ª–æ)
   - **api_hash**: (—Å—Ç—Ä–æ–∫–∞)

## üìã –®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è session string

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Pyrogram:
```bash
pip install pyrogram tgcrypto
```

### –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç generate_session.py:
```python
from pyrogram import Client

api_id = input("–í–≤–µ–¥–∏—Ç–µ api_id: ")
api_hash = input("–í–≤–µ–¥–∏—Ç–µ api_hash: ")
phone = input("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Å –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã): ")

with Client("test_session", api_id=int(api_id), api_hash=api_hash) as app:
    session_string = app.export_session_string()
    print("\n–í–∞—à session string:")
    print(session_string)
    print("\n‚ö†Ô∏è –í–ê–ñ–ù–û: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ .env.test –∏ –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ!")
```

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
```bash
python generate_session.py
# –í–≤–µ–¥–∏—Ç–µ api_id, api_hash, –Ω–æ–º–µ—Ä
# –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram
# –ü–æ–ª—É—á–∏—Ç–µ session_string
```

## üìã –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –ò–º—è: `Test Production Bot`
4. Username: `test_production_bot` (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

## üìã –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥—Ä—É–ø–ø

### –û–±—ã—á–Ω–∞—è –≥—Ä—É–ø–ø–∞:
1. –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É "Test Production"
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞
3. –°–¥–µ–ª–∞–π—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
4. –ü–æ–ª—É—á–∏—Ç–µ ID –≥—Ä—É–ø–ø—ã (—á–µ—Ä–µ–∑ @userinfobot –∏–ª–∏ /whoami –æ—Ç –±–æ—Ç–∞)

### –°—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞ —Å —Ç–æ–ø–∏–∫–∞–º–∏:
1. –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É "Test Forum"
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –¢–∏–ø –≥—Ä—É–ø–ø—ã ‚Üí –°–¥–µ–ª–∞—Ç—å –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –¢–µ–º—ã ‚Üí –í–∫–ª—é—á–∏—Ç—å —Ç–µ–º—ã
4. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∏ –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
5. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–ø–∏–∫–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

## üìã –®–∞–≥ 6: –°–æ–∑–¥–∞–Ω–∏–µ .env.test

```bash
# Telegram Test Credentials
TEST_API_ID=12345678
TEST_API_HASH=abcdef1234567890abcdef1234567890
TEST_SESSION_STRING=AQAOMTIzNDU2Nzg5...–æ—á–µ–Ω—å_–¥–ª–∏–Ω–Ω–∞—è_—Å—Ç—Ä–æ–∫–∞...
TEST_PHONE=+79991234567

# Test Bot
TEST_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TEST_BOT_USERNAME=@test_production_bot

# Test Groups
TEST_GROUP_ID=-1001234567890
TEST_FORUM_GROUP_ID=-1001234567891
TEST_TOPIC_ID=5

# Test Database (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤)
TEST_DB_HOST=localhost
TEST_DB_PORT=5433
TEST_DB_NAME=test_botdb
TEST_DB_USER=test_bot
TEST_DB_PASSWORD=test_pass

# Test Redis
TEST_REDIS_HOST=localhost
TEST_REDIS_PORT=6380
TEST_REDIS_DB=1
```

## üìã –®–∞–≥ 7: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ .gitignore

```gitignore
# Test credentials - NEVER commit!
.env.test
*.session
*.session-journal
test_session.session
```

## üöÄ –ó–∞–ø—É—Å–∫ E2E —Ç–µ—Å—Ç–æ–≤

### –¢–æ–ª—å–∫–æ —Å —Ñ–ª–∞–≥–æ–º (—Å–æ–≥–ª–∞—Å–Ω–æ —Ä–µ—à–µ–Ω–∏—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞):
```bash
# –í–∫–ª—é—á–∞–µ–º E2E Telegram —Ç–µ—Å—Ç—ã
export ENABLE_E2E_TELEGRAM=1

# –ó–∞–ø—É—Å–∫–∞–µ–º
./scripts/run_tests.sh e2e
```

### –ë–µ–∑ —Ñ–ª–∞–≥–∞ —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è:
```bash
# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é E2E Telegram –æ—Ç–∫–ª—é—á–µ–Ω—ã
./scripts/run_tests.sh e2e
# –í—ã–ø–æ–ª–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ Playwright —Ç–µ—Å—Ç—ã –∞–¥–º–∏–Ω–∫–∏
```

## üîß –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```python
from pyrogram import Client
import os

client = Client(
    "test",
    session_string=os.getenv("TEST_SESSION_STRING")
)

async def test():
    async with client:
        me = await client.get_me()
        print(f"‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫–∞–∫: {me.first_name} (@{me.username})")

import asyncio
asyncio.run(test())
```

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

**Session expired**:
- –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ session_string
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω

**FloodWait error**:
- –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ retry —Å exponential backoff

**ChatWriteForbidden**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω
- [ ] API credentials –ø–æ–ª—É—á–µ–Ω—ã
- [ ] Session string —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç —Å–æ–∑–¥–∞–Ω
- [ ] –ì—Ä—É–ø–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] .env.test –∑–∞–ø–æ–ª–Ω–µ–Ω
- [ ] .gitignore –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–π–¥–µ–Ω
- [ ] E2E —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å —Ñ–ª–∞–≥–æ–º

## ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!

1. **–ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env.test**
2. **–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫–∫–∞—É–Ω—Ç**
3. **–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ ENABLE_E2E_TELEGRAM=1**
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ git status –ø–µ—Ä–µ–¥ push**
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pre-commit hook –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏**

## üìù Pre-commit hook –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–°–æ–∑–¥–∞–π—Ç–µ `.git/hooks/pre-commit`:
```bash
#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–º–º–∏—Ç sensitive –¥–∞–Ω–Ω—ã—Ö

if git diff --cached --name-only | grep -E "\.env\.test|\.session|session_string"; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å sensitive —Ñ–∞–π–ª—ã!"
    echo "–§–∞–π–ª—ã .env.test –∏ *.session –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ .gitignore"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ session_string –≤ –∫–æ–¥–µ
if git diff --cached | grep -i "session_string" | grep -v "TEST_SESSION_STRING"; then
    echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–∞–π–¥–µ–Ω session_string –≤ –∫–æ–¥–µ!"
    echo "–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —ç—Ç–æ –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"
    read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# –ó–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤
./scripts/run_tests.sh precommit
```

–°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```bash
chmod +x .git/hooks/pre-commit
```

---

**–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: –í—ã –≥–æ—Ç–æ–≤—ã –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–º—É E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! üéâ